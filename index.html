<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>äººç‰©ç‚¼é‡‘å° | Psyche Alchemist</title>
    <style>
        /* --- 0. å…¨å±€å˜é‡ï¼šé»‘é‡‘é…è‰² (å¢å¼ºç‰ˆ) --- */
        :root {
            --bg-deep: #050505;
            --card-bg: rgba(16, 16, 16, 0.92); /* ç¨å¾®åŠ æ·±èƒŒæ™¯ */
            --gold-dim: #8a7348;
            --gold-bright: #ffdb8b; 
            --gold-glow: rgba(255, 215, 0, 0.25); /* è°ƒæ•´å…‰æ™•é€æ˜åº¦ */
            --text-main: #e0d6c5;
            --border-color: #4a3b22;
        }

        * { box-sizing: border-box; outline: none; }

        body {
            margin: 0;
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: "Songti SC", "SimSun", serif;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; padding: 20px;
            overflow-x: hidden; -webkit-tap-highlight-color: transparent;
        }

        /* --- 1. èƒŒæ™¯ç‰¹æ•ˆ (æµé‡‘æ˜Ÿäº‘) --- */
        .bg-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            background: 
                radial-gradient(circle at 30% 20%, rgba(80, 50, 10, 0.4) 0%, transparent 60%),
                radial-gradient(circle at 70% 80%, rgba(100, 70, 20, 0.3) 0%, transparent 60%);
            animation: breathe 10s ease-in-out infinite alternate;
        }
        @keyframes breathe {
            0% { opacity: 0.6; transform: scale(1); }
            100% { opacity: 0.9; transform: scale(1.05); }
        }

        .dust {
            position: absolute;
            background: var(--gold-bright);
            border-radius: 50%;
            box-shadow: 0 0 6px var(--gold-bright); 
            animation: float var(--duration) linear infinite;
            opacity: 0;
        }
        @keyframes float {
            0% { transform: translateY(100vh) scale(0); opacity: 0; }
            50% { opacity: 0.8; }
            100% { transform: translateY(-10vh) scale(1); opacity: 0; }
        }

        /* --- 2. é¡¶éƒ¨å¯¼èˆª --- */
        .header {
            width: 100%; max-width: 1000px;
            display: flex; justify-content: space-between; align-items: flex-start;
            margin-bottom: 25px; z-index: 10;
        }
        .title-group h1 {
            margin: 0; font-size: 1.8rem; color: var(--gold-bright);
            letter-spacing: 5px; 
            text-shadow: 0 0 15px var(--gold-glow); 
            font-weight: normal;
        }
        .title-group p { margin: 6px 0 0; font-size: 0.8rem; color: var(--gold-dim); letter-spacing: 3px; }

        .top-btns { display: flex; gap: 10px; }
        .nav-btn {
            background: rgba(0,0,0,0.6);
            border: 1px solid var(--gold-dim);
            color: var(--gold-bright);
            padding: 6px 14px; font-size: 0.8rem; border-radius: 4px;
            cursor: pointer; transition: all 0.3s;
            backdrop-filter: blur(5px);
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        .nav-btn:hover {
            background: var(--gold-dim); color: #000;
            box-shadow: 0 0 20px var(--gold-glow);
        }

        /* --- 3. é…ç½®åŒº --- */
        .config-bar {
            width: 100%; max-width: 1000px;
            background: rgba(20, 15, 5, 0.6);
            border: 1px solid var(--border-color);
            padding: 18px; border-radius: 8px;
            display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 30px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5), inset 0 0 20px rgba(212, 175, 55, 0.05);
            backdrop-filter: blur(10px);
        }
        .input-group { flex: 1; min-width: 200px; display: flex; flex-direction: column; gap: 6px; }
        .input-label { font-size: 0.75rem; color: var(--gold-dim); letter-spacing: 1px; }
        .glod-input {
            background: rgba(0,0,0,0.5); border: 1px solid var(--border-color);
            color: var(--gold-bright); padding: 10px 12px; border-radius: 4px;
            font-family: inherit; font-size: 0.9rem; transition: 0.3s;
        }
        .glod-input:focus { border-color: var(--gold-bright); box-shadow: 0 0 15px var(--gold-glow); }

        /* --- 4. ä¸»å·¥ä½œåŒº --- */
        .main-container {
            display: flex; gap: 30px; width: 100%; max-width: 1100px;
            flex-wrap: wrap; z-index: 5;
        }

        /* å·¦ä¾§æ§åˆ¶å° */
        .controls-panel {
            flex: 1; min-width: 300px;
            background: var(--card-bg);
            padding: 30px; border-radius: 10px;
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            backdrop-filter: blur(10px);
            display: flex; flex-direction: column; gap: 24px;
        }

        /* å­¦æœ¯è§£é‡ŠæŠ˜å æ  */
        .label-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .control-label { color: var(--gold-bright); font-size: 1rem; text-shadow: 0 0 8px var(--gold-glow); letter-spacing: 1px; }
        .info-icon {
            color: var(--gold-dim); border: 1px solid var(--gold-dim);
            width: 18px; height: 18px; border-radius: 50%;
            font-size: 12px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.3s; opacity: 0.7;
        }
        .info-icon:hover { opacity: 1; background: var(--gold-bright); color: #000; border-color: var(--gold-bright); box-shadow: 0 0 10px var(--gold-glow); }

        .info-text {
            font-size: 0.85rem; color: #a89f91; line-height: 1.6;
            background: rgba(0,0,0,0.4); padding: 0 12px;
            border-left: 2px solid var(--gold-dim);
            max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out, padding 0.4s ease, margin 0.4s ease;
            margin-bottom: 0;
            border-radius: 0 4px 4px 0;
        }
        .info-text.show { max-height: 300px; padding: 12px; margin-bottom: 15px; }

        select.glod-select {
            width: 100%; background: #0a0a0a; border: 1px solid var(--border-color);
            color: var(--text-main); padding: 12px; border-radius: 4px;
            font-family: "Songti SC", serif; font-size: 1rem; appearance: none;
            transition: 0.3s;
        }
        select.glod-select:focus { border-color: var(--gold-bright); box-shadow: 0 0 15px var(--gold-glow); }

        .alchemy-btn {
            margin-top: 15px; padding: 16px;
            background: linear-gradient(135deg, #2b2210 0%, #080808 100%);
            border: 1px solid var(--gold-dim);
            color: var(--gold-bright); font-size: 1.1rem; letter-spacing: 4px;
            cursor: pointer; border-radius: 4px; transition: all 0.4s;
            text-shadow: 0 0 8px var(--gold-glow);
            position: relative; overflow: hidden;
        }
        .alchemy-btn:hover {
            border-color: var(--gold-bright);
            box-shadow: 0 0 35px var(--gold-glow), inset 0 0 20px rgba(212, 175, 55, 0.2);
            transform: translateY(-2px);
        }
        .alchemy-btn:disabled { opacity: 0.5; cursor: not-allowed; box-shadow: none; transform: none; }

        /* å³ä¾§ç»“æœ */
        .result-panel {
            flex: 1.5; min-width: 300px;
            background: rgba(10, 10, 10, 0.9); padding: 40px; border-radius: 6px;
            border: 1px solid var(--border-color); min-height: 600px;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            position: relative;
        }
        .result-panel::before {
            content: ''; position: absolute; top: 12px; left: 12px; right: 12px; bottom: 12px;
            border: 1px solid rgba(138, 115, 72, 0.2); pointer-events: none;
        }
        #output-content {
            white-space: pre-wrap; line-height: 1.9; font-size: 1.05rem; opacity: 0.95;
            color: var(--text-main); height: 100%; overflow-y: auto;
            scrollbar-width: thin; scrollbar-color: var(--border-color) transparent;
        }
        h3 { color: var(--gold-bright); border-bottom: 1px solid var(--border-color); padding-bottom: 8px; margin-top: 30px; font-weight: normal; letter-spacing: 2px; }
        strong { color: var(--gold-bright); font-weight: normal; }
        blockquote { 
            border-left: 3px solid var(--gold-dim); margin: 20px 0; padding-left: 20px; 
            color: #bfaea8; font-style: italic; font-family: "KaiTi", serif;
        }

        /* --- 5. å¼¹çª— --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 100;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: 0.3s; backdrop-filter: blur(8px);
        }
        .modal-overlay.active { opacity: 1; pointer-events: all; }
        .modal-box {
            width: 90%; max-width: 650px; max-height: 85vh;
            background: #111; border: 1px solid var(--gold-dim);
            padding: 40px; border-radius: 8px;
            box-shadow: 0 0 60px rgba(212, 175, 55, 0.15);
            overflow-y: auto; text-align: left;
        }
        .modal-box h2 { margin-top: 0; color: var(--gold-bright); text-align: center; font-weight: normal; letter-spacing: 3px; border-bottom: 1px solid #333; padding-bottom: 20px; margin-bottom: 20px; }
        .modal-box h3 { color: var(--gold-dim); margin-top: 25px; font-size: 1.1rem; }
        .modal-box p, .modal-box li { color: #ccc; line-height: 1.8; font-size: 0.95rem; margin-bottom: 10px; }
        .close-modal {
            display: block; margin: 30px auto 0;
            background: transparent; border: 1px solid var(--gold-dim);
            color: var(--gold-dim); padding: 10px 35px; cursor: pointer; transition: 0.3s;
            font-size: 0.9rem; letter-spacing: 2px;
        }
        .close-modal:hover { background: var(--gold-dim); color: #000; box-shadow: 0 0 15px var(--gold-glow); }

        @media (max-width: 768px) {
            .header { flex-direction: column; gap: 15px; }
            .main-container { flex-direction: column; }
            .result-panel { min-height: 400px; padding: 20px; }
        }
    </style>
</head>
<body>

    <div class="bg-layer"></div>
    <div id="dust-container"></div>

    <div class="header">
        <div class="title-group">
            <h1>äººç‰©ç‚¼é‡‘å°</h1>
            <p>PSYCHE ALCHEMIST</p>
        </div>
        <div class="top-btns">
            <button class="nav-btn" onclick="openModal('theory')">ğŸ“œ åŸç† (Theory)</button>
            <button class="nav-btn" onclick="openModal('usage')">ğŸ”‘ ä½¿ç”¨æŒ‡å— (Guide)</button>
        </div>
    </div>

    <div class="config-bar">
        <div class="input-group">
            <span class="input-label">AI æœåŠ¡å•†</span>
            <select id="provider-select" class="glod-input" onchange="updateProvider()">
                <option value="silicon_cn" selected>ç¡…åŸºæµåŠ¨ (æ¨è)</option>
                <option value="silicon_com">ç¡…åŸºæµåŠ¨ (å¤‡ç”¨)</option>
                <option value="deepseek">DeepSeek å®˜æ–¹</option>
            </select>
        </div>
        <div class="input-group">
            <span class="input-label">æ¨¡å‹</span>
            <select id="model-select" class="glod-input">
                <option value="deepseek-ai/DeepSeek-V3" selected>DeepSeek-V3</option>
                <option value="deepseek-ai/DeepSeek-R1">DeepSeek-R1</option>
            </select>
        </div>
        <div class="input-group" style="flex: 2;">
            <span class="input-label">API Key</span>
            <input type="password" id="api-key" class="glod-input" placeholder="sk-...">
        </div>
    </div>

    <div class="main-container">
        <div class="controls-panel">
            
            <div class="control-item">
                <div class="label-row">
                    <label class="control-label">1. åŸå‹å†…æ ¸ (Archetype)</label>
                    <div class="info-icon" onclick="toggleInfo('info-archetype')">?</div>
                </div>
                <div id="info-archetype" class="info-text">
                    <strong>åŸå‹ï¼ˆArchetypeï¼‰ï¼š</strong>åŸºäºè£æ ¼ã€ŠåŸå‹ä¸é›†ä½“æ— æ„è¯†ã€‹[CW 9i]ã€‚åŸå‹å¹¶éå…·ä½“çš„äººç‰©ï¼Œè€Œæ˜¯é›†ä½“æ— æ„è¯†ä¸­é¢„å­˜çš„â€œå½¢å¼â€æˆ–â€œå¹²æ¯çš„æ²³åºŠâ€ (Riverbed)ã€‚åªæœ‰å½“ä¸ªäººç»éªŒä¹‹æ°´æµè¿‡ï¼Œå®ƒæ‰æ˜¾ç°å‡ºå…·ä½“çš„æ€§æ ¼ã€‚æœ¬å·¥å…·é‡‡ç”¨ç»´å¤šåˆ©äºšÂ·æ–½å¯†ç‰¹çš„45ç§ç¥è¯æ¨¡å‹è¿›è¡Œç°ä»£è½¬è¯‘ã€‚
                </div>
                <select id="archetype" class="glod-select">
                    <option value="" disabled selected>-- è¯·é€‰æ‹©æ ¸å¿ƒäººæ ¼ --</option>
                    <optgroup label="ã€ç†æ™ºä¸ç§©åºã€‘">
                        <option value="å®å¹²å®¶ (Apollo)">å®å¹²å®¶ï¼šè¿½æ±‚ç›®æ ‡ä¸ç§©åº (Apollo)</option>
                        <option value="ç­–ç•¥å®¶ (Athena)">ç­–ç•¥å®¶ï¼šç†æ™ºã€ç”šè‡³æœ‰äº›å†·é…· (Athena)</option>
                        <option value="éšå£« (Hades)">éšå£«ï¼šæ·±é‚ƒçš„å­¤ç‹¬è§‚å¯Ÿè€… (Hades)</option>
                    </optgroup>
                    <optgroup label="ã€æƒåŠ›ä¸æ„å¿—ã€‘">
                        <option value="é¢†è¢– (Zeus)">é¢†è¢–ï¼šæŒæ§ä¸€åˆ‡çš„æƒå¨ (Zeus)</option>
                        <option value="å¥³æ—é•¿ (Hera)">å¥³æ—é•¿ï¼šå®¶åº­ä¸æƒåŠ›çš„å®ˆæŠ¤è€… (Hera)</option>
                        <option value="æˆ˜å£« (Ares)">æˆ˜å£«ï¼šä¸ºäº†èƒœåˆ©è€Œæˆ˜ (Ares)</option>
                    </optgroup>
                    <optgroup label="ã€æƒ…æ„Ÿä¸è¿æ¥ã€‘">
                        <option value="ç…§é¡¾è€… (Demeter)">ç…§é¡¾è€…ï¼šæ— ç§çš„å¥‰çŒ® (Demeter)</option>
                        <option value="è‰ºæœ¯å®¶ (Poseidon)">è‰ºæœ¯å®¶ï¼šæƒ…ç»ªé£æš´çš„ä¸­å¿ƒ (Poseidon)</option>
                        <option value="ç¼ªæ–¯ (Aphrodite)">ç¼ªæ–¯ï¼šçµæ„Ÿä¸è¯±æƒ‘çš„åŒ–èº« (Aphrodite)</option>
                    </optgroup>
                    <optgroup label="ã€è‡ªç”±ä¸å˜é©ã€‘">
                        <option value="å¼„è‡£ (Hermes)">å¼„è‡£ï¼šå¹½é»˜çš„è¾¹ç•Œæ‰“ç ´è€… (Hermes)</option>
                        <option value="å¥³çŒæ‰‹ (Artemis)">å¥³çŒæ‰‹ï¼šç‹¬ç«‹çš„è‡ªç„¶ä¹‹å¥³ (Artemis)</option>
                        <option value="æµªå­ (Dionysus)">æµªå­ï¼šæ°¸è¿œé•¿ä¸å¤§çš„å½¼å¾—æ½˜ (Dionysus)</option>
                    </optgroup>
                </select>
            </div>

            <div class="control-item">
                <div class="label-row">
                    <label class="control-label">2. é˜´å½± (The Shadow)</label>
                    <div class="info-icon" onclick="toggleInfo('info-shadow')">?</div>
                </div>
                <div id="info-shadow" class="info-text">
                    <strong>é˜´å½±ï¼ˆShadowï¼‰ï¼š</strong>è£æ ¼è®¤ä¸ºé˜´å½±æ˜¯â€œé€šå¾€æ— æ„è¯†çš„ç‹­çª„ä¹‹é—¨â€[CW 9i]ã€‚å®ƒæ˜¯äººæ ¼ä¸­å› é€‚åº”ç¤¾ä¼šè€Œè¢«å‹æŠ‘çš„é»‘æš—é¢ï¼Œä½†ä¹Ÿæ˜¯ç”Ÿå‘½åŠ›å’Œåˆ›é€ åŠ›çš„æºæ³‰ã€‚æ²¡æœ‰é˜´å½±çš„äººç‰©æ˜¯æ‰å¹³çš„â€œçº¸ç‰‡äººâ€ã€‚æˆ‘ä»¬ä¸ä»…è¦çœ‹å®ƒçš„ç ´ååŠ›ï¼Œæ›´è¦çœ‹å®ƒå¦‚ä½•æ¨åŠ¨äººç‰©æˆé•¿ã€‚
                </div>
                <select id="shadow" class="glod-select">
                    <option value="auto">ğŸ”® éšæœºåŒ¹é… (AIåˆ†ææœ€æ·±ææƒ§)</option>
                    <option value="ç‹¬è£è€…">ç‹¬è£è€… (å¯¹åº”é¢†è¢–)</option>
                    <option value="èƒŒå›è€…">èƒŒå›è€… (å¯¹åº”å®å¹²å®¶)</option>
                    <option value="æ¯ç­è€…">æ¯ç­è€… (å¯¹åº”æˆ˜å£«)</option>
                    <option value="å—å®³è€…">å—å®³è€… (å¯¹åº”ç…§é¡¾è€…)</option>
                    <option value="æˆç˜¾è€…">æˆç˜¾è€… (å¯¹åº”æµªå­)</option>
                    <option value="é»‘å¯¡å¦‡">é»‘å¯¡å¦‡ (å¯¹åº”ç¼ªæ–¯)</option>
                    <option value="å†·è¡€æœºå™¨">å†·è¡€æœºå™¨ (å¯¹åº”ç­–ç•¥å®¶)</option>
                </select>
            </div>

            <div class="control-item">
                <div class="label-row">
                    <label class="control-label">3. æ—…ç¨‹é˜¶æ®µ (The Journey)</label>
                    <div class="info-icon" onclick="toggleInfo('info-stage')">?</div>
                </div>
                <div id="info-stage" class="info-text">
                    <strong>è‹±é›„ä¹‹æ—…ï¼ˆHero's Journeyï¼‰ï¼š</strong>åŸºäºçº¦ç‘Ÿå¤«Â·åè´å°”ã€Šåƒé¢è‹±é›„ã€‹ã€‚ç¥è¯ä¸ä»…æ˜¯æ•…äº‹ï¼Œè€Œæ˜¯å¿ƒç†æˆé•¿çš„éšå–»ã€‚å•ä¸€ç¥è¯ç»“æ„åŒ…æ‹¬ï¼šå¯ç¨‹ï¼ˆå“åº”å¬å”¤ï¼‰ã€è¯•ç‚¼ï¼ˆé²¸é±¼ä¹‹è…¹/æœ€ä½è°·ï¼‰ã€å½’æ¥ï¼ˆè·¨è¶Šé˜ˆé™å¹¶å¸¦å›æ©èµï¼‰ã€‚
                </div>
                <select id="stage" class="glod-select">
                    <option value="å¯ç¨‹ï¼šæ—¥å¸¸ç”Ÿæ´»çš„å´©å¡Œ">å¯ç¨‹ï¼šæ—¥å¸¸ç”Ÿæ´»çš„å´©å¡Œ</option>
                    <option value="è¯•ç‚¼ï¼šé²¸é±¼ä¹‹è…¹">è¯•ç‚¼ï¼šé²¸é±¼ä¹‹è…¹ (æœ€ä½è°·)</option>
                    <option value="é«˜æ½®ï¼šä¸é˜´å½±çš„å†³æˆ˜">é«˜æ½®ï¼šä¸é˜´å½±çš„å†³æˆ˜</option>
                    <option value="å½’æ¥ï¼šè·¨è¶Šå›å½’çš„é˜ˆé™">å½’æ¥ï¼šè·¨è¶Šå›å½’çš„é˜ˆé™</option>
                </select>
            </div>

            <div class="control-item">
                <label class="control-label">4. æ—¶ä»£èƒŒæ™¯ (Context)</label>
                <input type="text" id="context" class="glod-input" value="ç°ä»£éƒ½å¸‚" placeholder="ä¾‹ï¼š2077å¹´èµ›åšå¤œä¹‹åŸ...">
            </div>

            <button class="alchemy-btn" onclick="generateProfile()">âš—ï¸ æ³¨å…¥çµé­‚ Â· å¼€å§‹ç‚¼æˆ</button>
        </div>

        <div class="result-panel">
            <div id="output-content">
                <div style="text-align:center; color:#666; padding-top:100px;">
                    <p style="font-size:3rem; margin:0; opacity:0.3;">âš—ï¸</p>
                    <p>ç­‰å¾…ç‚¹ç‡ƒç‚¼é‡‘ä¹‹ç«...</p>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-theory" class="modal-overlay">
        <div class="modal-box">
            <h2>å¿ƒç†å­¦ä¸ç‚¼é‡‘æœ¯</h2>
            <div style="text-align:center; font-style:italic; color:#8a7348; margin-bottom:20px;">
                "åªè¦ä½ æ²¡æœ‰è§‰çŸ¥åˆ°æ½œæ„è¯†ï¼Œå®ƒå°±ä¼šä¸»å¯¼ä½ çš„ç”Ÿæ´»ï¼Œè€Œä½ ç§°ä¹‹ä¸ºå‘½è¿ã€‚" â€”â€” C.G.Jung
            </div>
            <p><strong>ä¸ºä»€ä¹ˆå«â€œäººç‰©ç‚¼é‡‘å°â€ï¼Ÿ</strong><br>
            è£æ ¼åœ¨ã€Šå¿ƒç†å­¦ä¸ç‚¼é‡‘æœ¯ã€‹ä¸­æŒ‡å‡ºï¼Œä¸­ä¸–çºªç‚¼é‡‘æœ¯å£«è¯•å›¾å°†é“…å˜æˆé‡‘çš„è¿‡ç¨‹ï¼Œå®é™…ä¸Šæ˜¯äººç±»å¿ƒçµâ€œä¸ªæ€§åŒ–â€ï¼ˆIndividuationï¼‰çš„éšå–»ã€‚æœ¬å·¥å…·æ­£æ˜¯åŸºäºè¿™ä¸€ç†å¿µï¼šåˆ›ä½œäººç‰©çš„è¿‡ç¨‹ï¼Œå°±æ˜¯å°†ç²—ç³™çš„æ€§æ ¼ç´ æï¼ˆé“…ï¼‰ï¼Œé€šè¿‡é˜´å½±çš„è¯•ç‚¼ï¼Œè½¬åŒ–ä¸ºå®Œæ•´çµé­‚ï¼ˆé‡‘ï¼‰çš„è¿‡ç¨‹ã€‚</p>
            <hr style="border:0; border-top:1px solid #333; margin:20px 0;">
            <h3>ç†è®ºåŸºçŸ³</h3>
            <ul>
                <li><strong>è£æ ¼åˆ†æå¿ƒç†å­¦ (Jungian Analytical Psychology)ï¼š</strong> æä¾›â€œåŸå‹â€ä½œä¸ºå¿ƒç†ç»“æ„çš„åŸºç¡€ï¼Œæä¾›â€œé˜´å½±â€ä½œä¸ºå¿ƒç†åŠ¨åŠ›çš„æºæ³‰ã€‚</li>
                <li><strong>ç¥è¯å­¦ (Joseph Campbell)ï¼š</strong> æä¾›â€œè‹±é›„ä¹‹æ—…â€ä½œä¸ºå™äº‹çš„æ—¶é—´è½´ï¼Œéšå–»äººçš„æˆé•¿é˜¶æ®µã€‚</li>
                <li><strong>ç»å…¸äººç‰©åŸå‹45ç§ (Victoria Lynn Schmidt)ï¼š</strong> æä¾›45ç§åŸå‹çš„ç°ä»£è½¬è¯‘ï¼Œè¿æ¥ç¥è¯ä¸ç°å®ã€‚</li>
            </ul>
            <button class="close-modal" onclick="closeModal('theory')">å…³é—­</button>
        </div>
    </div>

    <div id="modal-usage" class="modal-overlay">
        <div class="modal-box">
            <h2>ä½¿ç”¨æŒ‡å—</h2>
            <p>æœ¬å·¥å…·éœ€è¦æ¥å…¥ AI å¤§æ¨¡å‹ï¼ˆDeepSeekï¼‰æ¥é©±åŠ¨ã€‚</p>
            <ol>
                <li><strong>è·å– Keyï¼š</strong> æ¨èä½¿ç”¨ <a href="https://cloud.siliconflow.cn/" target="_blank" style="color:var(--gold-bright)">ç¡…åŸºæµåŠ¨</a> (æ³¨å†Œé€å…è´¹é¢åº¦)ã€‚</li>
                <li><strong>å¡«å…¥ Keyï¼š</strong> å°† sk- å¼€å¤´çš„å¯†é’¥ç²˜è´´åˆ°æœ¬é¡µé¡¶éƒ¨ã€‚</li>
                <li><strong>ç‚¹å‡» ? å›¾æ ‡ï¼š</strong> æŸ¥çœ‹æ¯ä¸ªå­¦æœ¯æ¦‚å¿µçš„æ·±åº¦è§£é‡Šã€‚</li>
                <li><strong>å¼€å§‹ï¼š</strong> é…ç½®å‚æ•°ï¼Œç‚¹å‡»ç‚¼æˆã€‚</li>
            </ol>
            <button class="close-modal" onclick="closeModal('usage')">æˆ‘æ˜ç™½äº†</button>
        </div>
    </div>

    <script>
        // --- é€»è¾‘ï¼šè§£é‡Šæ–‡æœ¬å±•å¼€ ---
        function toggleInfo(id) {
            const el = document.getElementById(id);
            el.classList.toggle('show');
        }

        // --- ç‰¹æ•ˆï¼šæµé‡‘å°˜åŸƒ ---
        function createDust() {
            const container = document.getElementById('dust-container');
            for(let i=0; i<45; i++) {
                const dust = document.createElement('div');
                dust.className = 'dust';
                dust.style.left = Math.random() * 100 + '%';
                dust.style.width = Math.random() * 4 + 'px';
                dust.style.height = dust.style.width;
                dust.style.setProperty('--duration', Math.random() * 5 + 6 + 's');
                dust.style.animationDelay = Math.random() * 5 + 's';
                container.appendChild(dust);
            }
        }
        createDust();

        // --- é€»è¾‘ï¼šå¼¹çª—/API/ç”Ÿæˆ ---
        function openModal(id) { document.getElementById('modal-' + id).classList.add('active'); }
        function closeModal(id) { document.getElementById('modal-' + id).classList.remove('active'); }

        const providers = {
            'silicon_cn': 'https://api.siliconflow.cn/v1/chat/completions',
            'silicon_com': 'https://api.siliconflow.com/v1/chat/completions',
            'deepseek': 'https://api.deepseek.com/chat/completions'
        };

        const apiKeyInput = document.getElementById('api-key');
        if(localStorage.getItem('user_api_key')) apiKeyInput.value = localStorage.getItem('user_api_key');
        apiKeyInput.addEventListener('input', (e) => localStorage.setItem('user_api_key', e.target.value));

        async function generateProfile() {
            const providerKey = document.getElementById('provider-select').value;
            const baseUrl = providers[providerKey];
            const modelName = document.getElementById('model-select').value;
            const apiKey = apiKeyInput.value.trim();

            const archetype = document.getElementById('archetype').value;
            const shadow = document.getElementById('shadow').value;
            const stage = document.getElementById('stage').value;
            const context = document.getElementById('context').value;
            const outputDiv = document.getElementById('output-content');
            const btn = document.querySelector('.alchemy-btn');

            if (!apiKey) { alert("è¯·å…ˆå¡«å…¥ API Key"); return; }
            if (!archetype) { alert("è¯·é€‰æ‹©åŸå‹"); return; }

            btn.disabled = true;
            btn.innerHTML = "ğŸ”¥ ç‚¼é‡‘ä¹‹ç«ç‡ƒçƒ§ä¸­...";
            outputDiv.innerHTML = '<div style="text-align:center; color:#8a7348; margin-top:50px;">æ­£åœ¨è¿æ¥é›†ä½“æ— æ„è¯†...<br>è§£æ ' + archetype + '...</div>';

            const prompt = `
                ä½ æ˜¯ä¸€ä½ç²¾é€šè£æ ¼åˆ†æå¿ƒç†å­¦ã€ã€Šå¿ƒç†å­¦ä¸ç‚¼é‡‘æœ¯ã€‹åŠåè´å°”ç¥è¯å­¦çš„åˆ›æ„å†™ä½œä¸“å®¶ã€‚
                è¯·åŸºäºä»¥ä¸‹å‚æ•°ï¼Œé€šè¿‡â€œå¿ƒç†ç‚¼é‡‘â€çš„è¿‡ç¨‹ï¼Œç”Ÿæˆä¸€ä»½æ·±åº¦äººç‰©å°ä¼ ï¼ˆHTMLæ ¼å¼ï¼‰ï¼š
                
                1.åŸå‹(æ²³åºŠ)ï¼š${archetype} (å‚è€ƒã€Šç»å…¸äººç‰©åŸå‹45ç§ã€‹ï¼Œå¿…é¡»ç°ä»£åŒ–)
                2.é˜´å½±(åŠ¨åŠ›)ï¼š${shadow} (è¿™æ˜¯é€šå¾€æ— æ„è¯†çš„ç‹­çª„ä¹‹é—¨ï¼Œè¯·å±•ç¤ºå…¶ç”Ÿå‘½åŠ›ä¸ç ´ååŠ›)
                3.æ—…ç¨‹(æ—¶é—´)ï¼š${stage} (åè´å°”è‹±é›„ä¹‹æ—…ç»“æ„)
                4.èƒŒæ™¯ï¼š${context}

                è¯·æŒ‰ä»¥ä¸‹HTMLç»“æ„è¾“å‡ºï¼ˆå†·å³»ã€å¿ƒç†åŠ¨åŠ›å­¦è§†è§’ï¼‰ï¼š
                <h3>â… . äººç‰©ä¾§å†™ (Profile)</h3>
                <p>
                <strong>å§“åï¼š</strong>[éšæœº]<br>
                <strong>è¡¨è±¡èŒä¸šï¼š</strong>[ç¬¦åˆåŸå‹ä½†æœ‰åå·®æ„Ÿçš„ç°ä»£èŒä¸š] (è¯·ä¸è¦å…¨éƒ¨ä¸ºç”Ÿæˆç¨‹åºå‘˜æˆ–AIç›¸å…³èŒä¸šï¼è¯·å¹¿æ³›å°è¯•ï¼šä½“åŠ›åŠ³åŠ¨è€…ã€ä¼ ç»Ÿæ‰‹è‰ºäººã€æœåŠ¡ä¸šã€åŒ»ç”Ÿã€æ•™å¸ˆã€è‰ºæœ¯å®¶ã€å…¬åŠ¡å‘˜ç­‰èŒä¸š)<br>
                <strong>æ ¸å¿ƒæ¬²æœ›ï¼š</strong>[åŸå‹åŠ¨åŠ›]<br>
                <strong>æœ€å¤§ææƒ§ï¼š</strong>[é˜´å½±ææƒ§]
                </p>

                <h3>â…¡. å¿ƒç†æ·±åº¦ (Psyche)</h3>
                <p><strong>å…‰æ˜çš„é¢å…· (Persona)ï¼š</strong>[ä»–åœ¨åˆ«äººçœ¼ä¸­çš„æ ·å­]</p>
                <p><strong>é˜´å½±çš„ä½è¯­ (Shadow)ï¼š</strong>[${shadow}å¦‚ä½•åœ¨æ— æ„è¯†ä¸­æ¥ç®¡ä»–ï¼Ÿå®ƒä¸ä»…æ˜¯é‚ªæ¶ï¼Œä¹Ÿæ˜¯è¢«å‹æŠ‘çš„ç”Ÿå‘½åŠ›ã€‚]</p>
                
                <h3>â…¢. ç‚¼é‡‘æ—¶åˆ» (${stage})</h3>
                <p><strong>å½“å‰çš„è¯•ç‚¼ï¼š</strong>[ç°å®å†²çªï¼Œéšå–»ç¥è¯å†…æ ¸]</p>
                <p><strong>è½¬åŒ–ä¸ç‰ºç‰²ï¼š</strong>[ä¸ºäº†å®Œæˆä¸ªæ€§åŒ–(Individuation)ï¼Œä»–å¿…é¡»ç‰ºç‰²ä»€ä¹ˆï¼Ÿ]</p>

                <h3>â…£. å‘½è¿ç‹¬ç™½</h3>
                <blockquote>â€œ[ä¸€å¥å°è¯]â€</blockquote>
            `;

            try {
                const response = await fetch(baseUrl, {
                    method: "POST",
                    headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
                    body: JSON.stringify({
                        model: modelName,
                        messages: [
                            {"role": "system", "content": "You are a creative writing assistant specialized in Jungian psychology."},
                            {"role": "user", "content": prompt}
                        ],
                        stream: true,
                        temperature: 0.8
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Error ${response.status}: ${errorText}`);
                }

                const reader = response.body.getReader();
                const decoder = new TextDecoder("utf-8");
                outputDiv.innerHTML = "";
                
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    const chunk = decoder.decode(value, { stream: true });
                    const lines = chunk.split('\n');
                    lines.forEach(line => {
                        if (line.startsWith('data: ')) {
                            const jsonStr = line.replace('data: ', '');
                            if (jsonStr === '[DONE]') return;
                            try {
                                const json = JSON.parse(jsonStr);
                                const content = json.choices[0].delta.content || "";
                                let formatted = content.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                                outputDiv.innerHTML += formatted;
                                outputDiv.scrollTop = outputDiv.scrollHeight;
                            } catch (e) {}
                        }
                    });
                }

            } catch (error) {
                outputDiv.innerHTML = `<div style="color:#a33; border:1px solid #a33; padding:15px;"><strong>ç‚¼æˆå¤±è´¥</strong><br>${error.message}</div>`;
            } finally {
                btn.disabled = false;
                btn.innerHTML = "âš—ï¸ æ³¨å…¥çµé­‚ Â· å¼€å§‹ç‚¼æˆ";
            }
        }
    </script>
</body>
</html>